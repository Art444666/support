<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>üí¨ –ê–Ω–æ–Ω–∏–º–Ω—ã–π —á–∞—Ç</title>
  <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      margin: 0;
      padding: 20px;
      background: linear-gradient(135deg, #1a1f2b, #0d1117);
      color: #e6edf3;
      min-height: 100vh;
    }
    h2 {
      text-align: center;
      color: #58a6ff;
      margin-bottom: 10px;
      text-shadow: 0 0 8px rgba(88,166,255,0.6);
    }
    p { text-align: center; margin-bottom: 20px; }
    .section {
      border: 1px solid #30363d;
      border-radius: 12px;
      padding: 15px;
      margin-bottom: 20px;
      background: rgba(22,27,34,0.85);
      box-shadow: 0 4px 20px rgba(0,0,0,0.4);
      transition: transform 0.2s ease, box-shadow 0.2s ease;
    }
    .section:hover { transform: translateY(-2px); box-shadow: 0 6px 24px rgba(0,0,0,0.6); }
    .section h3 {
      margin-top: 0;
      color: #79c0ff;
      border-bottom: 1px solid #30363d;
      padding-bottom: 5px;
    }
    .room-card {
      border: 1px solid #30363d;
      padding: 10px;
      margin: 8px 0;
      border-radius: 8px;
      background: linear-gradient(135deg, #21262d, #161b22);
      transition: transform 0.2s ease;
    }
    .room-card:hover { transform: translateX(5px); }
    .room-card.private { background: linear-gradient(135deg, #3b1f1f, #161b22); border-color: #ff7b72; }
    input, button {
      margin: 5px;
      padding: 10px;
      border-radius: 8px;
      border: 1px solid #30363d;
      background: #0d1117;
      color: #e6edf3;
      transition: border-color 0.2s ease, box-shadow 0.2s ease;
    }
    input:focus { border-color: #58a6ff; box-shadow: 0 0 8px rgba(88,166,255,0.6); outline: none; }
    button {
      cursor: pointer;
      background: linear-gradient(135deg, #238636, #2ea043);
      border: none;
      color: #fff;
      font-weight: bold;
      transition: transform 0.2s ease, box-shadow 0.2s ease;
    }
    button:hover { transform: scale(1.05); box-shadow: 0 0 12px rgba(46,160,67,0.6); }
    #adminBtn {
      position: fixed;
      top: 10px;
      right: 10px;
      background: linear-gradient(135deg, #8b5cf6, #6366f1);
      border: none;
      padding: 8px 14px;
      border-radius: 8px;
      color: #fff;
      font-weight: bold;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <h2>üí¨ –ê–Ω–æ–Ω–∏–º–Ω—ã–π —á–∞—Ç</h2>
  <p>–í—ã: <strong>{{ username }}</strong></p>

  <!-- –ö–Ω–æ–ø–∫–∞ –≤—Ö–æ–¥–∞ –≤ —Ä–µ–∂–∏–º –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ -->
  <button id="adminBtn">üîë –ê–¥–º–∏–Ω</button>

  <!-- –°–ø–∏—Å–æ–∫ –∫–æ–º–Ω–∞—Ç -->
  <div class="section" id="roomlist">
    <h3>üìã –°–ø–∏—Å–æ–∫ –∫–æ–º–Ω–∞—Ç</h3>
    <div id="openRooms"><h4>üîì –û—Ç–∫—Ä—ã—Ç—ã–µ</h4></div>
    <div id="privateRooms"><h4>üîê –ü—Ä–∏–≤–∞—Ç–Ω—ã–µ</h4></div>
  </div>

  <!-- –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–π –∫–æ–º–Ω–∞—Ç—ã -->
  <div class="section" id="create-room">
    <h3>‚ûï –°–æ–∑–¥–∞—Ç—å –∫–æ–º–Ω–∞—Ç—É</h3>
    <input id="newroom" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –∫–æ–º–Ω–∞—Ç—ã" />
    <input id="newpass" placeholder="–ü–∞—Ä–æ–ª—å (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)" />
    <button onclick="createRoom()">–°–æ–∑–¥–∞—Ç—å</button>
  </div>
    <!-- –ß–∞—Ç -->
  <div class="section" id="chatbox" style="display:none;">
    <h3>üí¨ –ß–∞—Ç</h3>
    <input id="msg" autocomplete="off" placeholder="–°–æ–æ–±—â–µ–Ω–∏–µ –∏–ª–∏ /ban –Ω–∏–∫" />
    <button onclick="sendMessage()">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
    <ul id="chat"></ul>
  </div>

  <!-- –°–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π -->
  <div class="section" id="users">
    <h3>üë• –£—á–∞—Å—Ç–Ω–∏–∫–∏ –∫–æ–º–Ω–∞—Ç—ã</h3>
    <ul id="userlist"></ul>
    <p id="ownerinfo"></p>
  </div>

  <script>
    const socket = io();
    let currentRoom = null;

    function createRoom() {
      const room = document.getElementById("newroom").value.trim();
      const password = document.getElementById("newpass").value.trim();
      if (!room) { alert("–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∫–æ–º–Ω–∞—Ç—ã."); return; }
      socket.emit("create_room", { room, password });
    }

    function joinRoom(room, isPrivate) {
      let password = "";
      if (isPrivate) { password = prompt("–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å –¥–ª—è –∫–æ–º–Ω–∞—Ç—ã " + room); }
      socket.emit("join_room", { room, password });
    }

    socket.on("room_error", msg => alert(msg));

    socket.on("room_list", list => {
      const openContainer = document.getElementById("openRooms");
      const privateContainer = document.getElementById("privateRooms");
      openContainer.innerHTML = "<h4>üîì –û—Ç–∫—Ä—ã—Ç—ã–µ</h4>";
      privateContainer.innerHTML = "<h4>üîê –ü—Ä–∏–≤–∞—Ç–Ω—ã–µ</h4>";
      list.forEach(room => {
        const cleanName = room.replace(" [–ø—Ä–∏–≤–∞—Ç]", "").trim();
        const isPrivate = room.includes("[–ø—Ä–∏–≤–∞—Ç]");
        const card = document.createElement("div");
        card.className = "room-card" + (isPrivate ? " private" : "");
        const title = document.createElement("strong");
        title.textContent = room;
        card.appendChild(title);
        const btn = document.createElement("button");
        btn.textContent = "–ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è";
        btn.onclick = () => joinRoom(cleanName, isPrivate);
        card.appendChild(btn);
        if (isPrivate) { privateContainer.appendChild(card); }
        else { openContainer.appendChild(card); }
      });
    });

    socket.on("room_joined", room => {
      currentRoom = room;
      document.getElementById("chatbox").style.display = "block";
      document.getElementById("chat").innerHTML = "";
    });

    socket.on("message", msg => {
      const li = document.createElement("li");
      li.textContent = msg;
      document.getElementById("chat").appendChild(li);
    });

    socket.on("userlist", data => {
      const ul = document.getElementById("userlist");
      ul.innerHTML = "";
      data.users.forEach(u => {
        const li = document.createElement("li");
        li.textContent = u;
        ul.appendChild(li);
      });
      document.getElementById("ownerinfo").innerHTML = `üëë –í–ª–∞–¥–µ–ª–µ—Ü: <span class="owner">${data.owner}</span>`;
    });

    function sendMessage() {
      const input = document.getElementById("msg");
      socket.send(input.value);
      input.value = "";
    }

    // –ê–¥–º–∏–Ω –∫–Ω–æ–ø–∫–∞
    document.getElementById("adminBtn").onclick = () => {
      const pass = prompt("–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞:");
      if (pass) { socket.emit("admin_login", { password: pass }); }
    };

    socket.on("admin_success", msg => alert(msg));
    socket.on("admin_error", msg => alert(msg));

    // –ü—Ä–∏–º–µ—Ä —Ñ—É–Ω–∫—Ü–∏–π –¥–ª—è –∞–¥–º–∏–Ω–∞
    function banIp(ip) {
      const reason = prompt("–ü—Ä–∏—á–∏–Ω–∞ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏:");
      socket.emit("admin_ban", { ip, reason });
    }

    function toggleGlobalBlock(enable) {
      const reason = prompt("–ü—Ä–∏—á–∏–Ω–∞ –≥–ª–æ–±–∞–ª—å–Ω–æ–π –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏:");
      socket.emit("admin_global_block", { enabled: enable, reason });
    }

    // –†–µ–¥–∏—Ä–µ–∫—Ç –≤ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å
    socket.on("redirect_admin", url => {
      window.location.href = url;
    });
  </script>
</body>
</html>
